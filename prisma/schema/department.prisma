// -----------------------------
// ENUMS
// -----------------------------

enum DepartmentType {
  ACADEMIC
  ADMINISTRATIVE
  SUPPORT
}

enum DepartmentStatus {
  ACTIVE
  INACTIVE
  ARCHIVED
}

enum RoleInDepartment {
  HOD
  TEACHER
}

// -----------------------------
// CORE DEPARTMENT MODEL
// -----------------------------

model Department {
  id          Int              @id @default(autoincrement())
  schoolId    Int
  code        String // Not global unique, scoped to school
  name        String
  type        DepartmentType   @default(ACADEMIC)
  status      DepartmentStatus @default(ACTIVE)
  description String?

  // Leadership
  headId   Int?
  headUser User? @relation("HeadOfDepartment", fields: [headId], references: [id], onDelete: SetNull)

  // People
  members DepartmentMember[]

  // Relations to other core modules
  subjects Subject[]

  // Meta
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  School    School   @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  @@unique([schoolId, code])
}

// -----------------------------
// DEPARTMENT MEMBERS (People)
// -----------------------------

model DepartmentMember {
  id           Int              @id @default(autoincrement())
  departmentId Int
  userId       Int
  role         RoleInDepartment @default(TEACHER)

  isActive Boolean @default(true)

  department Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([departmentId, userId])
}
