enum TodoStatus {
  TODO
  IN_PROGRESS
  DONE
}

model Todo {
  id       Int        @id @default(autoincrement())
  schoolId Int
  userId   Int
  text     String
  status   TodoStatus @default(TODO)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  school School @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  @@index([schoolId, userId])
}

enum GradingSystem {
  PERCENTAGE
  LETTER
  GPA
}

enum PromotionPolicy {
  AUTO
  MANUAL
}

enum DayOfWeek {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

enum AttendanceMode {
  DAILY
  PERIOD_WISE
}

model SchoolSettings {
  id       Int @id @default(autoincrement())
  schoolId Int @unique

  // Branding
  motto              String?
  backgroundImageUrl String?
  logoUrl            String?
  faviconUrl         String?

  // Address
  street  String?
  city    String?
  state   String?
  zipCode String?
  country String?

  // Contact
  phone   String?
  email   String?
  website String?

  // Academic
  attendanceMode  AttendanceMode  @default(DAILY)
  gradingSystem   GradingSystem   @default(PERCENTAGE)
  promotionPolicy PromotionPolicy @default(MANUAL)

  // School Day Timings
  schoolStartTime DateTime
  schoolEndTime   DateTime

  // Timetable
  maxPeriodsPerDay       Int     @default(8)
  minGapBetweenPeriods   Int?
  flexiblePeriodDuration Boolean @default(false)
  defaultPeriodLength    Int     @default(45)

  // Attendance
  lateMarkThreshold     Int?
  absentAfter           Int?
  allowExcuseSubmission Boolean @default(true)

  // Academic constraints
  maxSubjectsPerStudent     Int @default(8)
  maxRepeatPeriodsPerDay    Int @default(2)
  maxConsecutiveSameSubject Int @default(2)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  school School @relation(fields: [schoolId], references: [id], onDelete: Cascade)
}

model TimeSlot {
  id             Int       @id @default(autoincrement())
  schoolId       Int
  academicYearId Int
  day            DayOfWeek
  periodId       Int

  description String?
  isBreak     Boolean @default(false)

  period           TimePeriod       @relation(fields: [periodId], references: [id], onDelete: Cascade)
  timetableEntries TimetableEntry[]
  school           School           @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  academicYear     AcademicYear     @relation(fields: [academicYearId], references: [id], onDelete: Cascade)

  @@unique([schoolId, academicYearId, day, periodId])
  @@index([schoolId, day])
}
