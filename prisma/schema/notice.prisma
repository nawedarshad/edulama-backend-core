enum NoticeType {
  CLASS
  SUBJECT
}

enum NoticePriority {
  LOW
  NORMAL
  HIGH
}

model Notice {
  id             Int @id @default(autoincrement())
  schoolId       Int
  academicYearId Int

  title    String
  content  String
  priority NoticePriority @default(NORMAL)
  type     NoticeType

  // Context / Targeting
  classId   Int
  sectionId Int?
  subjectId Int?
  teacherId Int // TeacherProfile ID

  // Meta
  requiresAck Boolean @default(false)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  // Relations
  school       School         @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  academicYear AcademicYear   @relation(fields: [academicYearId], references: [id], onDelete: Cascade)
  class        Class          @relation(fields: [classId], references: [id], onDelete: Cascade)
  section      Section?       @relation(fields: [sectionId], references: [id], onDelete: SetNull)
  subject      Subject?       @relation(fields: [subjectId], references: [id], onDelete: SetNull)
  teacher      TeacherProfile @relation(fields: [teacherId], references: [id], onDelete: Cascade)

  attachments      NoticeAttachment[]
  acknowledgements NoticeAck[]

  @@index([schoolId, academicYearId])
  @@index([schoolId, classId])
  @@index([schoolId, teacherId])
  @@index([schoolId, subjectId])
}

model NoticeAttachment {
  id       Int    @id @default(autoincrement())
  noticeId Int
  fileName String
  fileUrl  String
  fileType String

  notice Notice @relation(fields: [noticeId], references: [id], onDelete: Cascade)
}

model NoticeAck {
  id        Int @id @default(autoincrement())
  noticeId  Int
  studentId Int

  acknowledgedAt DateTime @default(now())

  notice  Notice         @relation(fields: [noticeId], references: [id], onDelete: Cascade)
  student StudentProfile @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([noticeId, studentId])
}
