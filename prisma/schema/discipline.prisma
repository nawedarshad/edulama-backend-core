enum IncidentStatus {
  OPEN
  RESOLVED
  CANCELLED
}

model IncidentReport {
  id             Int @id @default(autoincrement())
  schoolId       Int
  academicYearId Int

  studentId Int? // optional â€“ can log general incidents
  student   StudentProfile? @relation(fields: [studentId], references: [id], onDelete: SetNull)

  title       String
  description String

  createdById Int
  createdBy   User @relation("CreatedIncidents", fields: [createdById], references: [id], onDelete: Cascade)

  status IncidentStatus @default(OPEN)

  resolvedById Int?
  resolvedBy   User? @relation("ResolvedIncidents", fields: [resolvedById], references: [id], onDelete: SetNull)

  resolvedAt     DateTime?
  resolutionNote String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  school              School               @relation(fields: [schoolId], references: [id])
  academicYear        AcademicYear         @relation(fields: [academicYearId], references: [id])
  incidentAttachments IncidentAttachment[]

  @@index([schoolId, academicYearId])
  @@index([status])
}

model IncidentAttachment {
  id           Int    @id @default(autoincrement())
  incidentId   Int
  fileUrl      String
  uploadedById Int?

  uploadedAt DateTime @default(now())

  incident   IncidentReport @relation(fields: [incidentId], references: [id], onDelete: Cascade)
  uploadedBy User?          @relation(fields: [uploadedById], references: [id], onDelete: SetNull)
}
