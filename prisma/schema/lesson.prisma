
enum SyllabusStatus {
  PLANNED
  IN_PROGRESS
  COMPLETED
  DEFERRED
}

model ClassDiary {
  id Int @id @default(autoincrement())

  // Tenant & academic isolation
  schoolId       Int
  academicYearId Int

  // Ownership
  teacherId Int
  teacher   TeacherProfile @relation(fields: [teacherId], references: [id], onDelete: Cascade)

  // Academic mapping
  classId        Int
  sectionId      Int
  subjectId      Int
  classSubjectId Int?

  // Content
  title       String // e.g. "Chapter 1: Intro"
  topic       String? // e.g. "Photosynthesis"
  description String? // What was taught
  homework    String?
  
  // Detailed Lesson Plan
  objective   String? // Learning objective of the session
  activity    String? // Activities performed (group work, lab, etc.)
  remarks     String? // Teacher's remarks/notes
  
  // Attachments/Links
  studyMaterial Json? // [{ "title": "Video", "url": "..." }]
  media         Json? // [{ "type": "image", "url": "..." }] for gallery view

  lessonDate DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  school       School        @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  academicYear AcademicYear  @relation(fields: [academicYearId], references: [id], onDelete: Cascade)
  class        Class         @relation(fields: [classId], references: [id], onDelete: Cascade)
  section      Section       @relation(fields: [sectionId], references: [id], onDelete: Cascade)
  subject      Subject       @relation(fields: [subjectId], references: [id], onDelete: Cascade)
  classSubject ClassSubject? @relation(fields: [classSubjectId], references: [id], onDelete: SetNull)

  @@index([schoolId, academicYearId])
  @@index([teacherId])
  @@index([classId, sectionId])
  @@index([subjectId])
  @@index([lessonDate])
}

model Syllabus {
  id Int @id @default(autoincrement())

  schoolId       Int
  academicYearId Int

  classId   Int
  subjectId Int

  // Hierarchy and Ordering
  parentId   Int?      // Null for Unit, set for Chapter/Topic
  parent     Syllabus? @relation("SyllabusHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  children   Syllabus[] @relation("SyllabusHierarchy")
  
  orderIndex Int       @default(0)

  title       String
  description String?
  learningOutcomes String? // "Student will be able to..."

  attachments Json? // [{ "title": "Syllabus PDF", "url": "..." }]

  // Tracking
  status         SyllabusStatus @default(PLANNED)
  estimatedHours Float?         // For planning
  
  isCompleted Boolean   @default(false) // Keeping for backward compatibility, sync with status
  completedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  school       School       @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  academicYear AcademicYear @relation(fields: [academicYearId], references: [id], onDelete: Cascade)
  class        Class        @relation(fields: [classId], references: [id], onDelete: Cascade)
  subject      Subject      @relation(fields: [subjectId], references: [id], onDelete: Cascade)

  @@index([schoolId, academicYearId])
  @@index([classId, subjectId])
  @@index([parentId])
}

