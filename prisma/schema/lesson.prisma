enum LessonStatus {
  DRAFT
  SUBMITTED
  APPROVED
  REJECTED
  COMPLETED
}

model LessonPlan {
  id Int @id @default(autoincrement())

  // Tenant & academic isolation
  schoolId       Int
  academicYearId Int

  // Ownership
  teacherId Int
  teacher   TeacherProfile @relation(fields: [teacherId], references: [id], onDelete: Cascade)

  // Academic mapping
  classId        Int
  sectionId      Int
  subjectId      Int
  classSubjectId Int?

  title       String
  chapter     String?
  topic       String?
  description String?

  lessonDate DateTime

  homework  String?
  materials String? // simple text, not arrays
  notes     String?

  status LessonStatus @default(DRAFT)

  // Approval (single step only)
  approvedById Int?
  approvedBy   User?     @relation(fields: [approvedById], references: [id], onDelete: SetNull)
  approvedAt   DateTime?

  // Coverage
  covered      Boolean   @default(false)
  coveredAt    DateTime?
  coverageNote String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  school       School        @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  academicYear AcademicYear  @relation(fields: [academicYearId], references: [id], onDelete: Cascade)
  class        Class         @relation(fields: [classId], references: [id], onDelete: Cascade)
  section      Section       @relation(fields: [sectionId], references: [id], onDelete: Cascade)
  subject      Subject       @relation(fields: [subjectId], references: [id], onDelete: Cascade)
  classSubject ClassSubject? @relation(fields: [classSubjectId], references: [id], onDelete: SetNull)

  @@index([schoolId, academicYearId])
  @@index([teacherId])
  @@index([classId, sectionId])
  @@index([subjectId])
  @@index([lessonDate])
  @@index([status])
}
