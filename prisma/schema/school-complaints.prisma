enum SchoolComplaintStatus {
  OPEN
  RESOLVED
  DISMISSED
}

model SchoolComplaint {
  id Int @id @default(autoincrement())

  // Tenant & academic isolation
  schoolId       Int
  academicYearId Int

  // Who raised the complaint
  raisedById Int
  raisedBy   User @relation(fields: [raisedById], references: [id], onDelete: Cascade)

  // Optional: who / what the complaint is about
  againstUserId Int?
  againstUser   User? @relation("ComplaintAgainstUser", fields: [againstUserId], references: [id], onDelete: SetNull)

  // Complaint details
  title       String
  description String

  // Lifecycle
  status SchoolComplaintStatus @default(OPEN)

  resolvedById   Int?
  resolvedBy     User?     @relation("ComplaintResolvedBy", fields: [resolvedById], references: [id], onDelete: SetNull)
  resolvedAt     DateTime?
  resolutionNote String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  school                     School                      @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  academicYear               AcademicYear                @relation(fields: [academicYearId], references: [id], onDelete: Cascade)
  schoolComplaintAttachments SchoolComplaintAttachment[]

  @@index([schoolId, academicYearId])
  @@index([status])
  @@index([raisedById])
}

model SchoolComplaintAttachment {
  id           Int    @id @default(autoincrement())
  complaintId  Int
  fileUrl      String
  uploadedById Int?

  uploadedAt DateTime @default(now())

  complaint  SchoolComplaint @relation(fields: [complaintId], references: [id], onDelete: Cascade)
  uploadedBy User?           @relation(fields: [uploadedById], references: [id], onDelete: SetNull)
}
